{"ast":null,"code":"import { createClient } from '@supabase/supabase-js';\nconst supabaseUrl = 'https://ptmpshcuvhshcwbpaqit.supabase.co';\nconst supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0bXBzaGN1dmhzaGN3YnBhcWl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1ODExNDIsImV4cCI6MjA3NDE1NzE0Mn0.Nrt89ux7TWCwPojWDgtDk3wXbeyT51ruMjmuzcvnlCY';\nexport const supabase = createClient(supabaseUrl, supabaseKey);\n\n// Product data types\n\n// Category management types\n\n// Get categories with product counts from the categories table\nexport const getCategoriesWithCounts = async () => {\n  try {\n    console.log('Fetching categories with counts from Supabase...');\n\n    // First, get all categories\n    const {\n      data: categories,\n      error: categoriesError\n    } = await supabase.from('categories').select('*').order('sort_order');\n    if (categoriesError) {\n      console.error('Categories error:', categoriesError);\n      throw categoriesError;\n    }\n\n    // Then get product counts for each category\n    const categoriesWithCounts = await Promise.all((categories || []).map(async category => {\n      const {\n        count,\n        error: countError\n      } = await supabase.from('product_data').select('*', {\n        count: 'exact',\n        head: true\n      }).eq('product_type', category.category_key);\n      if (countError) {\n        console.warn(`Error counting products for ${category.category_key}:`, countError);\n      }\n      return {\n        ...category,\n        product_count: count || 0\n      };\n    }));\n    console.log('Categories with counts received:', categoriesWithCounts === null || categoriesWithCounts === void 0 ? void 0 : categoriesWithCounts.length, 'items');\n    return categoriesWithCounts || [];\n  } catch (error) {\n    console.error('Error fetching categories with counts:', error);\n    return [];\n  }\n};\n\n// Legacy function for backwards compatibility\nexport const getProductCategories = async () => {\n  const categories = await getCategoriesWithCounts();\n  return categories.map(cat => ({\n    name: cat.category_key,\n    productCount: cat.product_count\n  }));\n};\n\n// Update category image\nexport const updateCategoryImage = async (categoryKey, imageUrl) => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.rpc('update_category_image', {\n      p_category_key: categoryKey,\n      p_image_url: imageUrl\n    });\n    if (error) throw error;\n    return data;\n  } catch (error) {\n    console.error('Error updating category image:', error);\n    return false;\n  }\n};\n\n// Toggle category status\nexport const toggleCategoryStatus = async categoryKey => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.rpc('toggle_category_status', {\n      p_category_key: categoryKey\n    });\n    if (error) throw error;\n    return data;\n  } catch (error) {\n    console.error('Error toggling category status:', error);\n    return false;\n  }\n};\n\n// Update category details\nexport const updateCategory = async (id, updates) => {\n  try {\n    const {\n      error\n    } = await supabase.from('categories').update({\n      ...updates,\n      updated_at: new Date().toISOString()\n    }).eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (error) {\n    console.error('Error updating category:', error);\n    return false;\n  }\n};\n\n// Get active categories only\nexport const getActiveCategories = async () => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('categories').select('*').eq('is_active', true).order('sort_order');\n    if (error) throw error;\n    return data || [];\n  } catch (error) {\n    console.error('Error fetching active categories:', error);\n    return [];\n  }\n};\n\n// Get products by category\nexport const getProductsByCategory = async category => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('product_data').select('*').eq('product_type', category).limit(50);\n    if (error) throw error;\n    return data || [];\n  } catch (error) {\n    console.error('Error fetching products:', error);\n    return [];\n  }\n};","map":{"version":3,"names":["createClient","supabaseUrl","supabaseKey","supabase","getCategoriesWithCounts","console","log","data","categories","error","categoriesError","from","select","order","categoriesWithCounts","Promise","all","map","category","count","countError","head","eq","category_key","warn","product_count","length","getProductCategories","cat","name","productCount","updateCategoryImage","categoryKey","imageUrl","rpc","p_category_key","p_image_url","toggleCategoryStatus","updateCategory","id","updates","update","updated_at","Date","toISOString","getActiveCategories","getProductsByCategory","limit"],"sources":["/home/alastair/Desktop/outpost-custom/outpost-custom/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = 'https://ptmpshcuvhshcwbpaqit.supabase.co';\r\nconst supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0bXBzaGN1dmhzaGN3YnBhcWl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1ODExNDIsImV4cCI6MjA3NDE1NzE0Mn0.Nrt89ux7TWCwPojWDgtDk3wXbeyT51ruMjmuzcvnlCY';\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseKey);\r\n\r\n// Product data types\r\nexport interface Product {\r\n  id: string;\r\n  sku_code: string;\r\n  style_code: string;\r\n  style_name: string;\r\n  brand: string;\r\n  product_type: string;\r\n  primary_colour: string;\r\n  primary_product_image_url: string;\r\n  single_price: string; // Changed to string since it comes as string from DB\r\n  gender: string;\r\n  categorisation: string;\r\n  colour_code: string;\r\n  colour_name: string;\r\n  colour_image: string;\r\n  size_code: string;\r\n  size_name: string;\r\n  size_range: string;\r\n  rgb: string;\r\n  // Additional fields from the full product data\r\n  fabric?: string;\r\n  colour_shade?: string;\r\n  age_group?: string;\r\n  accreditations?: string;\r\n  sustainable_organic?: string;\r\n  specification?: string;\r\n  retail_description?: string;\r\n}\r\n\r\n// Category management types\r\nexport interface CategoryData {\r\n  id: string;\r\n  category_key: string;\r\n  display_name: string;\r\n  description?: string;\r\n  image_url?: string;\r\n  is_active: boolean;\r\n  sort_order: number;\r\n  category_group: string;\r\n  product_count: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\n// Get categories with product counts from the categories table\r\nexport const getCategoriesWithCounts = async (): Promise<CategoryData[]> => {\r\n  try {\r\n    console.log('Fetching categories with counts from Supabase...');\r\n    \r\n    // First, get all categories\r\n    const { data: categories, error: categoriesError } = await supabase\r\n      .from('categories')\r\n      .select('*')\r\n      .order('sort_order');\r\n    \r\n    if (categoriesError) {\r\n      console.error('Categories error:', categoriesError);\r\n      throw categoriesError;\r\n    }\r\n    \r\n    // Then get product counts for each category\r\n    const categoriesWithCounts = await Promise.all(\r\n      (categories || []).map(async (category) => {\r\n        const { count, error: countError } = await supabase\r\n          .from('product_data')\r\n          .select('*', { count: 'exact', head: true })\r\n          .eq('product_type', category.category_key);\r\n        \r\n        if (countError) {\r\n          console.warn(`Error counting products for ${category.category_key}:`, countError);\r\n        }\r\n        \r\n        return {\r\n          ...category,\r\n          product_count: count || 0\r\n        };\r\n      })\r\n    );\r\n    \r\n    console.log('Categories with counts received:', categoriesWithCounts?.length, 'items');\r\n    return categoriesWithCounts || [];\r\n  } catch (error) {\r\n    console.error('Error fetching categories with counts:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// Legacy function for backwards compatibility\r\nexport const getProductCategories = async () => {\r\n  const categories = await getCategoriesWithCounts();\r\n  return categories.map(cat => ({\r\n    name: cat.category_key,\r\n    productCount: cat.product_count\r\n  }));\r\n};\r\n\r\n// Update category image\r\nexport const updateCategoryImage = async (categoryKey: string, imageUrl: string): Promise<boolean> => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .rpc('update_category_image', {\r\n        p_category_key: categoryKey,\r\n        p_image_url: imageUrl\r\n      });\r\n    \r\n    if (error) throw error;\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error updating category image:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Toggle category status\r\nexport const toggleCategoryStatus = async (categoryKey: string): Promise<boolean> => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .rpc('toggle_category_status', {\r\n        p_category_key: categoryKey\r\n      });\r\n    \r\n    if (error) throw error;\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error toggling category status:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Update category details\r\nexport const updateCategory = async (\r\n  id: string, \r\n  updates: Partial<Pick<CategoryData, 'display_name' | 'description' | 'category_group' | 'sort_order' | 'is_active'>>\r\n): Promise<boolean> => {\r\n  try {\r\n    const { error } = await supabase\r\n      .from('categories')\r\n      .update({ ...updates, updated_at: new Date().toISOString() })\r\n      .eq('id', id);\r\n    \r\n    if (error) throw error;\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error updating category:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Get active categories only\r\nexport const getActiveCategories = async (): Promise<CategoryData[]> => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('categories')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('sort_order');\r\n    \r\n    if (error) throw error;\r\n    return data || [];\r\n  } catch (error) {\r\n    console.error('Error fetching active categories:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// Get products by category\r\nexport const getProductsByCategory = async (category: string) => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('product_data')\r\n      .select('*')\r\n      .eq('product_type', category)\r\n      .limit(50);\r\n    \r\n    if (error) throw error;\r\n    return data || [];\r\n  } catch (error) {\r\n    console.error('Error fetching products:', error);\r\n    return [];\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}