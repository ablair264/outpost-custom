{"ast":null,"code":"var _jsxFileName = \"/home/alastair/Desktop/outpost-custom/outpost-custom/src/components/SmartSearchModal.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { X, Sparkles, Send, Lightbulb, MessageSquare } from 'lucide-react';\nimport './SmartSearchModal.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SmartSearchModal = ({\n  isOpen,\n  onClose,\n  onApplySearch\n}) => {\n  _s();\n  // Remote ON by default; set REACT_APP_SMART_SEARCH_REMOTE=false to force local-only\n  const SMART_SEARCH_REMOTE = (process.env.REACT_APP_SMART_SEARCH_REMOTE || '').toLowerCase() !== 'false';\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedQuestions, setSelectedQuestions] = useState([]);\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  // Quick questions to help users\n  const quickQuestions = [{\n    id: 'corporate-gifts',\n    question: 'Corporate gifts for clients',\n    category: 'purpose',\n    icon: /*#__PURE__*/_jsxDEV(Lightbulb, {\n      size: 16\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 13\n    }, this)\n  }, {\n    id: 'team-uniforms',\n    question: 'Uniforms for my team',\n    category: 'purpose',\n    icon: /*#__PURE__*/_jsxDEV(MessageSquare, {\n      size: 16\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 13\n    }, this)\n  }, {\n    id: 'promotional-items',\n    question: 'Promotional items for events',\n    category: 'purpose',\n    icon: /*#__PURE__*/_jsxDEV(Sparkles, {\n      size: 16\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 13\n    }, this)\n  }, {\n    id: 'outdoor-workwear',\n    question: 'Outdoor workwear that lasts',\n    category: 'style',\n    icon: /*#__PURE__*/_jsxDEV(Lightbulb, {\n      size: 16\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 13\n    }, this)\n  }, {\n    id: 'budget-friendly',\n    question: 'Budget-friendly options',\n    category: 'budget',\n    icon: /*#__PURE__*/_jsxDEV(MessageSquare, {\n      size: 16\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 13\n    }, this)\n  }, {\n    id: 'premium-quality',\n    question: 'Premium quality products',\n    category: 'budget',\n    icon: /*#__PURE__*/_jsxDEV(Sparkles, {\n      size: 16\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 13\n    }, this)\n  }, {\n    id: 'large-quantities',\n    question: 'Large quantity orders',\n    category: 'purpose',\n    icon: /*#__PURE__*/_jsxDEV(Lightbulb, {\n      size: 16\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }, this)\n  }, {\n    id: 'sustainable',\n    question: 'Eco-friendly & sustainable',\n    category: 'style',\n    icon: /*#__PURE__*/_jsxDEV(MessageSquare, {\n      size: 16\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }, this)\n  }];\n  const exampleQueries = [\"I need branded polo shirts for a team of 20 office workers\", \"High-vis safety gear for construction workers\", \"Promotional tote bags for a trade show under £10 each\", \"Warm winter jackets for outdoor staff\", \"Sustainable workwear options with company logo\"];\n  const toggleQuestion = questionId => {\n    setSelectedQuestions(prev => prev.includes(questionId) ? prev.filter(id => id !== questionId) : [...prev, questionId]);\n  };\n  const handleSearch = async () => {\n    if (!searchQuery.trim() && selectedQuestions.length === 0) return;\n    setIsProcessing(true);\n    try {\n      // Build search query from selected questions and text\n      const selectedQuestionTexts = quickQuestions.filter(q => selectedQuestions.includes(q.id)).map(q => q.question);\n      const fullQuery = [searchQuery, ...selectedQuestionTexts].filter(Boolean).join('. ');\n      if (!SMART_SEARCH_REMOTE) {\n        // Local-only: derive simple filters from query and let Supabase do the heavy lifting\n        const localFilters = generateFallbackFilters(fullQuery);\n        console.log('[SmartSearch] Using local matching only. Filters:', localFilters);\n        setIsProcessing(false);\n        onApplySearch(fullQuery, localFilters);\n        onClose();\n        return;\n      }\n\n      // Remote AI-powered filter generation (only if explicitly enabled)\n      const generatedFilters = await generateFiltersFromQuery(fullQuery, selectedQuestionTexts);\n      setIsProcessing(false);\n      onApplySearch(fullQuery, generatedFilters);\n      onClose();\n    } catch (error) {\n      console.error('Search failed:', error);\n      setIsProcessing(false);\n      // Could show error message to user here\n    }\n  };\n\n  // AI-powered filter generation using backend API\n  const generateFiltersFromQuery = async (query, selectedQuestionTexts) => {\n    const explicitUrl = process.env.REACT_APP_SMART_SEARCH_URL; // full endpoint, e.g. https://splitfin-zoho-api.onrender.com/api/smart-search\n    const renderBase = process.env.REACT_APP_RENDER_API_BASE_URL; // base URL, e.g. https://splitfin-zoho-api.onrender.com\n    const apiBase = process.env.REACT_APP_API_BASE_URL; // base path, e.g. /api or https://host/api\n\n    const bases = [];\n    if (explicitUrl) bases.push(explicitUrl);\n    if (renderBase) {\n      bases.push(`${renderBase.replace(/\\/$/, '')}/api/smart-search`);\n      bases.push(`${renderBase.replace(/\\/$/, '')}/smart-search`);\n    }\n    if (apiBase) bases.push(`${apiBase.replace(/\\/$/, '')}/smart-search`);\n    // Local/Netlify defaults\n    bases.push('/api/smart-search');\n    bases.push('/.netlify/functions/smart-search');\n    const payload = {\n      mode: 'ai',\n      query,\n      selectedQuestions: selectedQuestionTexts,\n      availableFilters: {\n        productTypes: ['T-Shirts', 'Hoodies', 'Polo Shirts', 'Jackets', 'Bags', 'Accessories'],\n        materials: ['Cotton', 'Polyester', 'Cotton/Polyester blends', 'Viscose blends', 'Organic Cotton'],\n        brands: [\"AWDis Just T's\", 'Bella + Canvas', 'Gildan', 'Fruit of the Loom', 'Russell'],\n        genders: ['Male', 'Female', 'Unisex'],\n        ageGroups: ['Adult', 'Youth', 'Kids'],\n        priceRange: {\n          min: 0,\n          max: 100\n        }\n      }\n    };\n\n    // De-duplicate while preserving order\n    const tried = new Set();\n    for (const base of bases) {\n      if (!base || tried.has(base)) continue;\n      tried.add(base);\n      try {\n        var _data, _data2, _data3, _data4, _data4$data;\n        const url = base;\n        const response = await fetch(url, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(payload)\n        });\n        const contentType = response.headers.get('content-type') || '';\n        console.log('[SmartSearch] Request', {\n          url,\n          status: response.status,\n          ok: response.ok,\n          contentType\n        });\n        let data;\n        if (contentType.includes('application/json')) {\n          data = await response.json();\n        } else {\n          const text = await response.text();\n          try {\n            data = JSON.parse(text);\n          } catch {\n            console.warn(`[SmartSearch] Non-JSON response from ${url}:`, text.slice(0, 200));\n            throw new Error(`Non-JSON response (${response.status})`);\n          }\n        }\n\n        // Accept either normalized responses (success + filters) or plain filters\n        if ((_data = data) !== null && _data !== void 0 && _data.success && (_data2 = data) !== null && _data2 !== void 0 && _data2.filters) {\n          console.log('AI Explanation:', data.explanation);\n          console.log('Generated Filters:', JSON.stringify(data.filters, null, 2));\n          return data.filters;\n        } else if ((_data3 = data) !== null && _data3 !== void 0 && _data3.filters) {\n          console.log('Generated Filters (no success flag):', JSON.stringify(data.filters, null, 2));\n          return data.filters;\n        } else if ((_data4 = data) !== null && _data4 !== void 0 && (_data4$data = _data4.data) !== null && _data4$data !== void 0 && _data4$data.filters) {\n          console.log('Generated Filters (nested data):', JSON.stringify(data.data.filters, null, 2));\n          return data.data.filters;\n        } else {\n          var _data5, _data6;\n          console.warn('[SmartSearch] Upstream payload had no filters. Full payload follows:');\n          console.dir(data);\n          console.warn('AI search failed, using fallback:', (_data5 = data) === null || _data5 === void 0 ? void 0 : _data5.error);\n          return ((_data6 = data) === null || _data6 === void 0 ? void 0 : _data6.fallback) || {};\n        }\n      } catch (err) {\n        console.warn('[SmartSearch] API base failed:', base, err);\n        // try next base\n      }\n    }\n    console.error('All API bases failed; using fallback filters');\n    return generateFallbackFilters(query);\n  };\n\n  // Fallback function for when API fails\n  const generateFallbackFilters = query => {\n    const filters = {};\n    const lowerQuery = query.toLowerCase();\n\n    // Product type detection - using actual product types from your database\n    if (lowerQuery.includes('polo')) {\n      filters.productTypes = ['Polos'];\n    } else if (lowerQuery.includes('shirt') || lowerQuery.includes('tee') || lowerQuery.includes('t-shirt')) {\n      filters.productTypes = ['T-Shirts'];\n    }\n    if (lowerQuery.includes('hoodie') || lowerQuery.includes('sweatshirt')) {\n      filters.productTypes = ['Hoodies'];\n    }\n    if (lowerQuery.includes('jacket') || lowerQuery.includes('coat')) {\n      filters.productTypes = ['Jackets'];\n    }\n    if (lowerQuery.includes('bag') || lowerQuery.includes('tote')) {\n      filters.productTypes = ['Bags'];\n    }\n\n    // Price detection\n    if (lowerQuery.includes('budget') || lowerQuery.includes('cheap') || lowerQuery.includes('under £10')) {\n      filters.priceMax = 10;\n    }\n    if (lowerQuery.includes('premium') || lowerQuery.includes('high quality')) {\n      filters.priceMin = 50;\n    }\n    if (lowerQuery.includes('under £25')) {\n      filters.priceMax = 25;\n    }\n\n    // Material/sustainability detection\n    if (lowerQuery.includes('sustainable') || lowerQuery.includes('eco') || lowerQuery.includes('organic')) {\n      filters.materials = ['Organic Cotton', 'Recycled'];\n    }\n\n    // Gender detection\n    if (lowerQuery.includes('office') || lowerQuery.includes('corporate')) {\n      filters.genders = ['Unisex'];\n    }\n    return filters;\n  };\n  const clearAll = () => {\n    setSearchQuery('');\n    setSelectedQuestions([]);\n  };\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"smart-search-overlay\",\n    onClick: onClose,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"smart-search-modal\",\n      onClick: e => e.stopPropagation(),\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"header-content\",\n          children: [/*#__PURE__*/_jsxDEV(Sparkles, {\n            size: 24,\n            className: \"header-icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"Smart Product Search\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Tell us what you need and we'll find the perfect products\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 283,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"close-button\",\n          onClick: onClose,\n          children: /*#__PURE__*/_jsxDEV(X, {\n            size: 24\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-body\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"search-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"search-label\",\n            children: \"What are you looking for?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"search-input-container\",\n            children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n              className: \"search-textarea\",\n              placeholder: \"Describe what you need... (e.g., 'I need branded polo shirts for a team of 20 office workers')\",\n              value: searchQuery,\n              onChange: e => setSearchQuery(e.target.value),\n              rows: 3\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 299,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"questions-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Or choose what applies to you:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"questions-grid\",\n            children: quickQuestions.map(question => /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `question-button ${selectedQuestions.includes(question.id) ? 'selected' : ''}`,\n              onClick: () => toggleQuestion(question.id),\n              children: [question.icon, /*#__PURE__*/_jsxDEV(\"span\", {\n                children: question.question\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 320,\n                columnNumber: 19\n              }, this)]\n            }, question.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"examples-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Example searches:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"examples-list\",\n            children: exampleQueries.map((example, index) => /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"example-button\",\n              onClick: () => setSearchQuery(example),\n              children: [\"\\\"\", example, \"\\\"\"]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 331,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-footer\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"clear-button\",\n          onClick: clearAll,\n          disabled: !searchQuery && selectedQuestions.length === 0,\n          children: \"Clear All\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"search-button\",\n          onClick: handleSearch,\n          disabled: !searchQuery.trim() && selectedQuestions.length === 0 || isProcessing,\n          children: isProcessing ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"spinner\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 17\n            }, this), \"Finding products...\"]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(Send, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 364,\n              columnNumber: 17\n            }, this), \"Smart Search\"]\n          }, void 0, true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 274,\n    columnNumber: 5\n  }, this);\n};\n_s(SmartSearchModal, \"nQvjJjJki4pNj0alinl3AK8iVHo=\");\n_c = SmartSearchModal;\nexport default SmartSearchModal;\nvar _c;\n$RefreshReg$(_c, \"SmartSearchModal\");","map":{"version":3,"names":["React","useState","X","Sparkles","Send","Lightbulb","MessageSquare","jsxDEV","_jsxDEV","Fragment","_Fragment","SmartSearchModal","isOpen","onClose","onApplySearch","_s","SMART_SEARCH_REMOTE","process","env","REACT_APP_SMART_SEARCH_REMOTE","toLowerCase","searchQuery","setSearchQuery","selectedQuestions","setSelectedQuestions","isProcessing","setIsProcessing","quickQuestions","id","question","category","icon","size","fileName","_jsxFileName","lineNumber","columnNumber","exampleQueries","toggleQuestion","questionId","prev","includes","filter","handleSearch","trim","length","selectedQuestionTexts","q","map","fullQuery","Boolean","join","localFilters","generateFallbackFilters","console","log","generatedFilters","generateFiltersFromQuery","error","query","explicitUrl","REACT_APP_SMART_SEARCH_URL","renderBase","REACT_APP_RENDER_API_BASE_URL","apiBase","REACT_APP_API_BASE_URL","bases","push","replace","payload","mode","availableFilters","productTypes","materials","brands","genders","ageGroups","priceRange","min","max","tried","Set","base","has","add","_data","_data2","_data3","_data4","_data4$data","url","response","fetch","method","headers","body","JSON","stringify","contentType","get","status","ok","data","json","text","parse","warn","slice","Error","success","filters","explanation","_data5","_data6","dir","fallback","err","lowerQuery","priceMax","priceMin","clearAll","className","onClick","children","e","stopPropagation","placeholder","value","onChange","target","rows","example","index","disabled","_c","$RefreshReg$"],"sources":["/home/alastair/Desktop/outpost-custom/outpost-custom/src/components/SmartSearchModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { X, Sparkles, Send, Lightbulb, MessageSquare } from 'lucide-react';\nimport { ProductFilters } from '../lib/productBrowserApi';\nimport './SmartSearchModal.css';\n\ninterface SmartSearchModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onApplySearch: (query: string, filters: ProductFilters) => void;\n}\n\ninterface QuickQuestion {\n  id: string;\n  question: string;\n  category: 'purpose' | 'audience' | 'style' | 'budget';\n  icon: React.ReactNode;\n}\n\nconst SmartSearchModal: React.FC<SmartSearchModalProps> = ({\n  isOpen,\n  onClose,\n  onApplySearch\n}) => {\n  // Remote ON by default; set REACT_APP_SMART_SEARCH_REMOTE=false to force local-only\n  const SMART_SEARCH_REMOTE = (process.env.REACT_APP_SMART_SEARCH_REMOTE || '').toLowerCase() !== 'false';\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedQuestions, setSelectedQuestions] = useState<string[]>([]);\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  // Quick questions to help users\n  const quickQuestions: QuickQuestion[] = [\n    {\n      id: 'corporate-gifts',\n      question: 'Corporate gifts for clients',\n      category: 'purpose',\n      icon: <Lightbulb size={16} />\n    },\n    {\n      id: 'team-uniforms',\n      question: 'Uniforms for my team',\n      category: 'purpose',\n      icon: <MessageSquare size={16} />\n    },\n    {\n      id: 'promotional-items',\n      question: 'Promotional items for events',\n      category: 'purpose',\n      icon: <Sparkles size={16} />\n    },\n    {\n      id: 'outdoor-workwear',\n      question: 'Outdoor workwear that lasts',\n      category: 'style',\n      icon: <Lightbulb size={16} />\n    },\n    {\n      id: 'budget-friendly',\n      question: 'Budget-friendly options',\n      category: 'budget',\n      icon: <MessageSquare size={16} />\n    },\n    {\n      id: 'premium-quality',\n      question: 'Premium quality products',\n      category: 'budget',\n      icon: <Sparkles size={16} />\n    },\n    {\n      id: 'large-quantities',\n      question: 'Large quantity orders',\n      category: 'purpose',\n      icon: <Lightbulb size={16} />\n    },\n    {\n      id: 'sustainable',\n      question: 'Eco-friendly & sustainable',\n      category: 'style',\n      icon: <MessageSquare size={16} />\n    }\n  ];\n\n  const exampleQueries = [\n    \"I need branded polo shirts for a team of 20 office workers\",\n    \"High-vis safety gear for construction workers\",\n    \"Promotional tote bags for a trade show under £10 each\",\n    \"Warm winter jackets for outdoor staff\",\n    \"Sustainable workwear options with company logo\"\n  ];\n\n  const toggleQuestion = (questionId: string) => {\n    setSelectedQuestions(prev => \n      prev.includes(questionId) \n        ? prev.filter(id => id !== questionId)\n        : [...prev, questionId]\n    );\n  };\n\n  const handleSearch = async () => {\n    if (!searchQuery.trim() && selectedQuestions.length === 0) return;\n\n    setIsProcessing(true);\n\n    try {\n      // Build search query from selected questions and text\n      const selectedQuestionTexts = quickQuestions\n        .filter(q => selectedQuestions.includes(q.id))\n        .map(q => q.question);\n      \n      const fullQuery = [searchQuery, ...selectedQuestionTexts]\n        .filter(Boolean)\n        .join('. ');\n\n      if (!SMART_SEARCH_REMOTE) {\n        // Local-only: derive simple filters from query and let Supabase do the heavy lifting\n        const localFilters = generateFallbackFilters(fullQuery);\n        console.log('[SmartSearch] Using local matching only. Filters:', localFilters);\n        setIsProcessing(false);\n        onApplySearch(fullQuery, localFilters);\n        onClose();\n        return;\n      }\n\n      // Remote AI-powered filter generation (only if explicitly enabled)\n      const generatedFilters = await generateFiltersFromQuery(fullQuery, selectedQuestionTexts);\n\n      setIsProcessing(false);\n      onApplySearch(fullQuery, generatedFilters);\n      onClose();\n    } catch (error) {\n      console.error('Search failed:', error);\n      setIsProcessing(false);\n      // Could show error message to user here\n    }\n  };\n\n  // AI-powered filter generation using backend API\n  const generateFiltersFromQuery = async (query: string, selectedQuestionTexts: string[]): Promise<ProductFilters> => {\n    const explicitUrl = process.env.REACT_APP_SMART_SEARCH_URL; // full endpoint, e.g. https://splitfin-zoho-api.onrender.com/api/smart-search\n    const renderBase = process.env.REACT_APP_RENDER_API_BASE_URL; // base URL, e.g. https://splitfin-zoho-api.onrender.com\n    const apiBase = process.env.REACT_APP_API_BASE_URL; // base path, e.g. /api or https://host/api\n\n    const bases: string[] = [];\n    if (explicitUrl) bases.push(explicitUrl);\n    if (renderBase) {\n      bases.push(`${renderBase.replace(/\\/$/, '')}/api/smart-search`);\n      bases.push(`${renderBase.replace(/\\/$/, '')}/smart-search`);\n    }\n    if (apiBase) bases.push(`${apiBase.replace(/\\/$/, '')}/smart-search`);\n    // Local/Netlify defaults\n    bases.push('/api/smart-search');\n    bases.push('/.netlify/functions/smart-search');\n    const payload = {\n      mode: 'ai',\n      query,\n      selectedQuestions: selectedQuestionTexts,\n      availableFilters: {\n        productTypes: ['T-Shirts', 'Hoodies', 'Polo Shirts', 'Jackets', 'Bags', 'Accessories'],\n        materials: ['Cotton', 'Polyester', 'Cotton/Polyester blends', 'Viscose blends', 'Organic Cotton'],\n        brands: [\"AWDis Just T's\", 'Bella + Canvas', 'Gildan', 'Fruit of the Loom', 'Russell'],\n        genders: ['Male', 'Female', 'Unisex'],\n        ageGroups: ['Adult', 'Youth', 'Kids'],\n        priceRange: { min: 0, max: 100 }\n      }\n    };\n\n    // De-duplicate while preserving order\n    const tried = new Set<string>();\n    for (const base of bases) {\n      if (!base || tried.has(base)) continue;\n      tried.add(base);\n      try {\n        const url = base;\n        const response = await fetch(url, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        });\n\n        const contentType = response.headers.get('content-type') || '';\n        console.log('[SmartSearch] Request', { url, status: response.status, ok: response.ok, contentType });\n        let data: any;\n        if (contentType.includes('application/json')) {\n          data = await response.json();\n        } else {\n          const text = await response.text();\n          try {\n            data = JSON.parse(text);\n          } catch {\n            console.warn(`[SmartSearch] Non-JSON response from ${url}:`, text.slice(0, 200));\n            throw new Error(`Non-JSON response (${response.status})`);\n          }\n        }\n\n        // Accept either normalized responses (success + filters) or plain filters\n        if (data?.success && data?.filters) {\n          console.log('AI Explanation:', data.explanation);\n          console.log('Generated Filters:', JSON.stringify(data.filters, null, 2));\n          return data.filters;\n        } else if (data?.filters) {\n          console.log('Generated Filters (no success flag):', JSON.stringify(data.filters, null, 2));\n          return data.filters;\n        } else if (data?.data?.filters) {\n          console.log('Generated Filters (nested data):', JSON.stringify(data.data.filters, null, 2));\n          return data.data.filters;\n        } else {\n          console.warn('[SmartSearch] Upstream payload had no filters. Full payload follows:');\n          console.dir(data);\n          console.warn('AI search failed, using fallback:', data?.error);\n          return data?.fallback || {};\n        }\n      } catch (err) {\n        console.warn('[SmartSearch] API base failed:', base, err);\n        // try next base\n      }\n    }\n\n    console.error('All API bases failed; using fallback filters');\n    return generateFallbackFilters(query);\n  };\n\n  // Fallback function for when API fails\n  const generateFallbackFilters = (query: string): ProductFilters => {\n    const filters: ProductFilters = {};\n    const lowerQuery = query.toLowerCase();\n\n    // Product type detection - using actual product types from your database\n    if (lowerQuery.includes('polo')) {\n      filters.productTypes = ['Polos'];\n    } else if (lowerQuery.includes('shirt') || lowerQuery.includes('tee') || lowerQuery.includes('t-shirt')) {\n      filters.productTypes = ['T-Shirts'];\n    }\n    if (lowerQuery.includes('hoodie') || lowerQuery.includes('sweatshirt')) {\n      filters.productTypes = ['Hoodies'];\n    }\n    if (lowerQuery.includes('jacket') || lowerQuery.includes('coat')) {\n      filters.productTypes = ['Jackets'];\n    }\n    if (lowerQuery.includes('bag') || lowerQuery.includes('tote')) {\n      filters.productTypes = ['Bags'];\n    }\n\n    // Price detection\n    if (lowerQuery.includes('budget') || lowerQuery.includes('cheap') || lowerQuery.includes('under £10')) {\n      filters.priceMax = 10;\n    }\n    if (lowerQuery.includes('premium') || lowerQuery.includes('high quality')) {\n      filters.priceMin = 50;\n    }\n    if (lowerQuery.includes('under £25')) {\n      filters.priceMax = 25;\n    }\n\n    // Material/sustainability detection\n    if (lowerQuery.includes('sustainable') || lowerQuery.includes('eco') || lowerQuery.includes('organic')) {\n      filters.materials = ['Organic Cotton', 'Recycled'];\n    }\n\n    // Gender detection\n    if (lowerQuery.includes('office') || lowerQuery.includes('corporate')) {\n      filters.genders = ['Unisex'];\n    }\n\n    return filters;\n  };\n\n  const clearAll = () => {\n    setSearchQuery('');\n    setSelectedQuestions([]);\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"smart-search-overlay\" onClick={onClose}>\n      <div className=\"smart-search-modal\" onClick={(e) => e.stopPropagation()}>\n        \n        {/* Header */}\n        <div className=\"modal-header\">\n          <div className=\"header-content\">\n            <Sparkles size={24} className=\"header-icon\" />\n            <div>\n              <h2>Smart Product Search</h2>\n              <p>Tell us what you need and we'll find the perfect products</p>\n            </div>\n          </div>\n          <button className=\"close-button\" onClick={onClose}>\n            <X size={24} />\n          </button>\n        </div>\n\n        {/* Scrollable Body */}\n        <div className=\"modal-body\">\n          {/* Main Search */}\n          <div className=\"search-section\">\n            <label className=\"search-label\">\n              What are you looking for?\n            </label>\n            <div className=\"search-input-container\">\n              <textarea\n                className=\"search-textarea\"\n                placeholder=\"Describe what you need... (e.g., 'I need branded polo shirts for a team of 20 office workers')\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                rows={3}\n              />\n            </div>\n          </div>\n\n          {/* Quick Questions */}\n          <div className=\"questions-section\">\n            <h3>Or choose what applies to you:</h3>\n            <div className=\"questions-grid\">\n              {quickQuestions.map(question => (\n                <button\n                  key={question.id}\n                  className={`question-button ${selectedQuestions.includes(question.id) ? 'selected' : ''}`}\n                  onClick={() => toggleQuestion(question.id)}\n                >\n                  {question.icon}\n                  <span>{question.question}</span>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Example Queries */}\n          <div className=\"examples-section\">\n            <h4>Example searches:</h4>\n            <div className=\"examples-list\">\n              {exampleQueries.map((example, index) => (\n                <button\n                  key={index}\n                  className=\"example-button\"\n                  onClick={() => setSearchQuery(example)}\n                >\n                  \"{example}\"\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"modal-footer\">\n          <button \n            className=\"clear-button\"\n            onClick={clearAll}\n            disabled={!searchQuery && selectedQuestions.length === 0}\n          >\n            Clear All\n          </button>\n          <button \n            className=\"search-button\"\n            onClick={handleSearch}\n            disabled={(!searchQuery.trim() && selectedQuestions.length === 0) || isProcessing}\n          >\n            {isProcessing ? (\n              <>\n                <div className=\"spinner\"></div>\n                Finding products...\n              </>\n            ) : (\n              <>\n                <Send size={18} />\n                Smart Search\n              </>\n            )}\n          </button>\n        </div>\n\n      </div>\n    </div>\n  );\n};\n\nexport default SmartSearchModal;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,QAAQ,OAAO;AACvC,SAASC,CAAC,EAAEC,QAAQ,EAAEC,IAAI,EAAEC,SAAS,EAAEC,aAAa,QAAQ,cAAc;AAE1E,OAAO,wBAAwB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAehC,MAAMC,gBAAiD,GAAGA,CAAC;EACzDC,MAAM;EACNC,OAAO;EACPC;AACF,CAAC,KAAK;EAAAC,EAAA;EACJ;EACA,MAAMC,mBAAmB,GAAG,CAACC,OAAO,CAACC,GAAG,CAACC,6BAA6B,IAAI,EAAE,EAAEC,WAAW,CAAC,CAAC,KAAK,OAAO;EACvG,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGrB,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACsB,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGvB,QAAQ,CAAW,EAAE,CAAC;EACxE,MAAM,CAACwB,YAAY,EAAEC,eAAe,CAAC,GAAGzB,QAAQ,CAAC,KAAK,CAAC;;EAEvD;EACA,MAAM0B,cAA+B,GAAG,CACtC;IACEC,EAAE,EAAE,iBAAiB;IACrBC,QAAQ,EAAE,6BAA6B;IACvCC,QAAQ,EAAE,SAAS;IACnBC,IAAI,eAAEvB,OAAA,CAACH,SAAS;MAAC2B,IAAI,EAAE;IAAG;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE;EAC9B,CAAC,EACD;IACER,EAAE,EAAE,eAAe;IACnBC,QAAQ,EAAE,sBAAsB;IAChCC,QAAQ,EAAE,SAAS;IACnBC,IAAI,eAAEvB,OAAA,CAACF,aAAa;MAAC0B,IAAI,EAAE;IAAG;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE;EAClC,CAAC,EACD;IACER,EAAE,EAAE,mBAAmB;IACvBC,QAAQ,EAAE,8BAA8B;IACxCC,QAAQ,EAAE,SAAS;IACnBC,IAAI,eAAEvB,OAAA,CAACL,QAAQ;MAAC6B,IAAI,EAAE;IAAG;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE;EAC7B,CAAC,EACD;IACER,EAAE,EAAE,kBAAkB;IACtBC,QAAQ,EAAE,6BAA6B;IACvCC,QAAQ,EAAE,OAAO;IACjBC,IAAI,eAAEvB,OAAA,CAACH,SAAS;MAAC2B,IAAI,EAAE;IAAG;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE;EAC9B,CAAC,EACD;IACER,EAAE,EAAE,iBAAiB;IACrBC,QAAQ,EAAE,yBAAyB;IACnCC,QAAQ,EAAE,QAAQ;IAClBC,IAAI,eAAEvB,OAAA,CAACF,aAAa;MAAC0B,IAAI,EAAE;IAAG;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE;EAClC,CAAC,EACD;IACER,EAAE,EAAE,iBAAiB;IACrBC,QAAQ,EAAE,0BAA0B;IACpCC,QAAQ,EAAE,QAAQ;IAClBC,IAAI,eAAEvB,OAAA,CAACL,QAAQ;MAAC6B,IAAI,EAAE;IAAG;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE;EAC7B,CAAC,EACD;IACER,EAAE,EAAE,kBAAkB;IACtBC,QAAQ,EAAE,uBAAuB;IACjCC,QAAQ,EAAE,SAAS;IACnBC,IAAI,eAAEvB,OAAA,CAACH,SAAS;MAAC2B,IAAI,EAAE;IAAG;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE;EAC9B,CAAC,EACD;IACER,EAAE,EAAE,aAAa;IACjBC,QAAQ,EAAE,4BAA4B;IACtCC,QAAQ,EAAE,OAAO;IACjBC,IAAI,eAAEvB,OAAA,CAACF,aAAa;MAAC0B,IAAI,EAAE;IAAG;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE;EAClC,CAAC,CACF;EAED,MAAMC,cAAc,GAAG,CACrB,4DAA4D,EAC5D,+CAA+C,EAC/C,uDAAuD,EACvD,uCAAuC,EACvC,gDAAgD,CACjD;EAED,MAAMC,cAAc,GAAIC,UAAkB,IAAK;IAC7Cf,oBAAoB,CAACgB,IAAI,IACvBA,IAAI,CAACC,QAAQ,CAACF,UAAU,CAAC,GACrBC,IAAI,CAACE,MAAM,CAACd,EAAE,IAAIA,EAAE,KAAKW,UAAU,CAAC,GACpC,CAAC,GAAGC,IAAI,EAAED,UAAU,CAC1B,CAAC;EACH,CAAC;EAED,MAAMI,YAAY,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAI,CAACtB,WAAW,CAACuB,IAAI,CAAC,CAAC,IAAIrB,iBAAiB,CAACsB,MAAM,KAAK,CAAC,EAAE;IAE3DnB,eAAe,CAAC,IAAI,CAAC;IAErB,IAAI;MACF;MACA,MAAMoB,qBAAqB,GAAGnB,cAAc,CACzCe,MAAM,CAACK,CAAC,IAAIxB,iBAAiB,CAACkB,QAAQ,CAACM,CAAC,CAACnB,EAAE,CAAC,CAAC,CAC7CoB,GAAG,CAACD,CAAC,IAAIA,CAAC,CAAClB,QAAQ,CAAC;MAEvB,MAAMoB,SAAS,GAAG,CAAC5B,WAAW,EAAE,GAAGyB,qBAAqB,CAAC,CACtDJ,MAAM,CAACQ,OAAO,CAAC,CACfC,IAAI,CAAC,IAAI,CAAC;MAEb,IAAI,CAACnC,mBAAmB,EAAE;QACxB;QACA,MAAMoC,YAAY,GAAGC,uBAAuB,CAACJ,SAAS,CAAC;QACvDK,OAAO,CAACC,GAAG,CAAC,mDAAmD,EAAEH,YAAY,CAAC;QAC9E1B,eAAe,CAAC,KAAK,CAAC;QACtBZ,aAAa,CAACmC,SAAS,EAAEG,YAAY,CAAC;QACtCvC,OAAO,CAAC,CAAC;QACT;MACF;;MAEA;MACA,MAAM2C,gBAAgB,GAAG,MAAMC,wBAAwB,CAACR,SAAS,EAAEH,qBAAqB,CAAC;MAEzFpB,eAAe,CAAC,KAAK,CAAC;MACtBZ,aAAa,CAACmC,SAAS,EAAEO,gBAAgB,CAAC;MAC1C3C,OAAO,CAAC,CAAC;IACX,CAAC,CAAC,OAAO6C,KAAK,EAAE;MACdJ,OAAO,CAACI,KAAK,CAAC,gBAAgB,EAAEA,KAAK,CAAC;MACtChC,eAAe,CAAC,KAAK,CAAC;MACtB;IACF;EACF,CAAC;;EAED;EACA,MAAM+B,wBAAwB,GAAG,MAAAA,CAAOE,KAAa,EAAEb,qBAA+B,KAA8B;IAClH,MAAMc,WAAW,GAAG3C,OAAO,CAACC,GAAG,CAAC2C,0BAA0B,CAAC,CAAC;IAC5D,MAAMC,UAAU,GAAG7C,OAAO,CAACC,GAAG,CAAC6C,6BAA6B,CAAC,CAAC;IAC9D,MAAMC,OAAO,GAAG/C,OAAO,CAACC,GAAG,CAAC+C,sBAAsB,CAAC,CAAC;;IAEpD,MAAMC,KAAe,GAAG,EAAE;IAC1B,IAAIN,WAAW,EAAEM,KAAK,CAACC,IAAI,CAACP,WAAW,CAAC;IACxC,IAAIE,UAAU,EAAE;MACdI,KAAK,CAACC,IAAI,CAAC,GAAGL,UAAU,CAACM,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,mBAAmB,CAAC;MAC/DF,KAAK,CAACC,IAAI,CAAC,GAAGL,UAAU,CAACM,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,eAAe,CAAC;IAC7D;IACA,IAAIJ,OAAO,EAAEE,KAAK,CAACC,IAAI,CAAC,GAAGH,OAAO,CAACI,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,eAAe,CAAC;IACrE;IACAF,KAAK,CAACC,IAAI,CAAC,mBAAmB,CAAC;IAC/BD,KAAK,CAACC,IAAI,CAAC,kCAAkC,CAAC;IAC9C,MAAME,OAAO,GAAG;MACdC,IAAI,EAAE,IAAI;MACVX,KAAK;MACLpC,iBAAiB,EAAEuB,qBAAqB;MACxCyB,gBAAgB,EAAE;QAChBC,YAAY,EAAE,CAAC,UAAU,EAAE,SAAS,EAAE,aAAa,EAAE,SAAS,EAAE,MAAM,EAAE,aAAa,CAAC;QACtFC,SAAS,EAAE,CAAC,QAAQ,EAAE,WAAW,EAAE,yBAAyB,EAAE,gBAAgB,EAAE,gBAAgB,CAAC;QACjGC,MAAM,EAAE,CAAC,gBAAgB,EAAE,gBAAgB,EAAE,QAAQ,EAAE,mBAAmB,EAAE,SAAS,CAAC;QACtFC,OAAO,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,QAAQ,CAAC;QACrCC,SAAS,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,MAAM,CAAC;QACrCC,UAAU,EAAE;UAAEC,GAAG,EAAE,CAAC;UAAEC,GAAG,EAAE;QAAI;MACjC;IACF,CAAC;;IAED;IACA,MAAMC,KAAK,GAAG,IAAIC,GAAG,CAAS,CAAC;IAC/B,KAAK,MAAMC,IAAI,IAAIhB,KAAK,EAAE;MACxB,IAAI,CAACgB,IAAI,IAAIF,KAAK,CAACG,GAAG,CAACD,IAAI,CAAC,EAAE;MAC9BF,KAAK,CAACI,GAAG,CAACF,IAAI,CAAC;MACf,IAAI;QAAA,IAAAG,KAAA,EAAAC,MAAA,EAAAC,MAAA,EAAAC,MAAA,EAAAC,WAAA;QACF,MAAMC,GAAG,GAAGR,IAAI;QAChB,MAAMS,QAAQ,GAAG,MAAMC,KAAK,CAACF,GAAG,EAAE;UAChCG,MAAM,EAAE,MAAM;UACdC,OAAO,EAAE;YAAE,cAAc,EAAE;UAAmB,CAAC;UAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC5B,OAAO;QAC9B,CAAC,CAAC;QAEF,MAAM6B,WAAW,GAAGP,QAAQ,CAACG,OAAO,CAACK,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE;QAC9D7C,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAE;UAAEmC,GAAG;UAAEU,MAAM,EAAET,QAAQ,CAACS,MAAM;UAAEC,EAAE,EAAEV,QAAQ,CAACU,EAAE;UAAEH;QAAY,CAAC,CAAC;QACpG,IAAII,IAAS;QACb,IAAIJ,WAAW,CAACzD,QAAQ,CAAC,kBAAkB,CAAC,EAAE;UAC5C6D,IAAI,GAAG,MAAMX,QAAQ,CAACY,IAAI,CAAC,CAAC;QAC9B,CAAC,MAAM;UACL,MAAMC,IAAI,GAAG,MAAMb,QAAQ,CAACa,IAAI,CAAC,CAAC;UAClC,IAAI;YACFF,IAAI,GAAGN,IAAI,CAACS,KAAK,CAACD,IAAI,CAAC;UACzB,CAAC,CAAC,MAAM;YACNlD,OAAO,CAACoD,IAAI,CAAC,wCAAwChB,GAAG,GAAG,EAAEc,IAAI,CAACG,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;YAChF,MAAM,IAAIC,KAAK,CAAC,sBAAsBjB,QAAQ,CAACS,MAAM,GAAG,CAAC;UAC3D;QACF;;QAEA;QACA,IAAI,CAAAf,KAAA,GAAAiB,IAAI,cAAAjB,KAAA,eAAJA,KAAA,CAAMwB,OAAO,KAAAvB,MAAA,GAAIgB,IAAI,cAAAhB,MAAA,eAAJA,MAAA,CAAMwB,OAAO,EAAE;UAClCxD,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAE+C,IAAI,CAACS,WAAW,CAAC;UAChDzD,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEyC,IAAI,CAACC,SAAS,CAACK,IAAI,CAACQ,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;UACxE,OAAOR,IAAI,CAACQ,OAAO;QACrB,CAAC,MAAM,KAAAvB,MAAA,GAAIe,IAAI,cAAAf,MAAA,eAAJA,MAAA,CAAMuB,OAAO,EAAE;UACxBxD,OAAO,CAACC,GAAG,CAAC,sCAAsC,EAAEyC,IAAI,CAACC,SAAS,CAACK,IAAI,CAACQ,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;UAC1F,OAAOR,IAAI,CAACQ,OAAO;QACrB,CAAC,MAAM,KAAAtB,MAAA,GAAIc,IAAI,cAAAd,MAAA,gBAAAC,WAAA,GAAJD,MAAA,CAAMc,IAAI,cAAAb,WAAA,eAAVA,WAAA,CAAYqB,OAAO,EAAE;UAC9BxD,OAAO,CAACC,GAAG,CAAC,kCAAkC,EAAEyC,IAAI,CAACC,SAAS,CAACK,IAAI,CAACA,IAAI,CAACQ,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;UAC3F,OAAOR,IAAI,CAACA,IAAI,CAACQ,OAAO;QAC1B,CAAC,MAAM;UAAA,IAAAE,MAAA,EAAAC,MAAA;UACL3D,OAAO,CAACoD,IAAI,CAAC,sEAAsE,CAAC;UACpFpD,OAAO,CAAC4D,GAAG,CAACZ,IAAI,CAAC;UACjBhD,OAAO,CAACoD,IAAI,CAAC,mCAAmC,GAAAM,MAAA,GAAEV,IAAI,cAAAU,MAAA,uBAAJA,MAAA,CAAMtD,KAAK,CAAC;UAC9D,OAAO,EAAAuD,MAAA,GAAAX,IAAI,cAAAW,MAAA,uBAAJA,MAAA,CAAME,QAAQ,KAAI,CAAC,CAAC;QAC7B;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZ9D,OAAO,CAACoD,IAAI,CAAC,gCAAgC,EAAExB,IAAI,EAAEkC,GAAG,CAAC;QACzD;MACF;IACF;IAEA9D,OAAO,CAACI,KAAK,CAAC,8CAA8C,CAAC;IAC7D,OAAOL,uBAAuB,CAACM,KAAK,CAAC;EACvC,CAAC;;EAED;EACA,MAAMN,uBAAuB,GAAIM,KAAa,IAAqB;IACjE,MAAMmD,OAAuB,GAAG,CAAC,CAAC;IAClC,MAAMO,UAAU,GAAG1D,KAAK,CAACvC,WAAW,CAAC,CAAC;;IAEtC;IACA,IAAIiG,UAAU,CAAC5E,QAAQ,CAAC,MAAM,CAAC,EAAE;MAC/BqE,OAAO,CAACtC,YAAY,GAAG,CAAC,OAAO,CAAC;IAClC,CAAC,MAAM,IAAI6C,UAAU,CAAC5E,QAAQ,CAAC,OAAO,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,KAAK,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,SAAS,CAAC,EAAE;MACvGqE,OAAO,CAACtC,YAAY,GAAG,CAAC,UAAU,CAAC;IACrC;IACA,IAAI6C,UAAU,CAAC5E,QAAQ,CAAC,QAAQ,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,YAAY,CAAC,EAAE;MACtEqE,OAAO,CAACtC,YAAY,GAAG,CAAC,SAAS,CAAC;IACpC;IACA,IAAI6C,UAAU,CAAC5E,QAAQ,CAAC,QAAQ,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,MAAM,CAAC,EAAE;MAChEqE,OAAO,CAACtC,YAAY,GAAG,CAAC,SAAS,CAAC;IACpC;IACA,IAAI6C,UAAU,CAAC5E,QAAQ,CAAC,KAAK,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,MAAM,CAAC,EAAE;MAC7DqE,OAAO,CAACtC,YAAY,GAAG,CAAC,MAAM,CAAC;IACjC;;IAEA;IACA,IAAI6C,UAAU,CAAC5E,QAAQ,CAAC,QAAQ,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,OAAO,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,WAAW,CAAC,EAAE;MACrGqE,OAAO,CAACQ,QAAQ,GAAG,EAAE;IACvB;IACA,IAAID,UAAU,CAAC5E,QAAQ,CAAC,SAAS,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,cAAc,CAAC,EAAE;MACzEqE,OAAO,CAACS,QAAQ,GAAG,EAAE;IACvB;IACA,IAAIF,UAAU,CAAC5E,QAAQ,CAAC,WAAW,CAAC,EAAE;MACpCqE,OAAO,CAACQ,QAAQ,GAAG,EAAE;IACvB;;IAEA;IACA,IAAID,UAAU,CAAC5E,QAAQ,CAAC,aAAa,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,KAAK,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,SAAS,CAAC,EAAE;MACtGqE,OAAO,CAACrC,SAAS,GAAG,CAAC,gBAAgB,EAAE,UAAU,CAAC;IACpD;;IAEA;IACA,IAAI4C,UAAU,CAAC5E,QAAQ,CAAC,QAAQ,CAAC,IAAI4E,UAAU,CAAC5E,QAAQ,CAAC,WAAW,CAAC,EAAE;MACrEqE,OAAO,CAACnC,OAAO,GAAG,CAAC,QAAQ,CAAC;IAC9B;IAEA,OAAOmC,OAAO;EAChB,CAAC;EAED,MAAMU,QAAQ,GAAGA,CAAA,KAAM;IACrBlG,cAAc,CAAC,EAAE,CAAC;IAClBE,oBAAoB,CAAC,EAAE,CAAC;EAC1B,CAAC;EAED,IAAI,CAACZ,MAAM,EAAE,OAAO,IAAI;EAExB,oBACEJ,OAAA;IAAKiH,SAAS,EAAC,sBAAsB;IAACC,OAAO,EAAE7G,OAAQ;IAAA8G,QAAA,eACrDnH,OAAA;MAAKiH,SAAS,EAAC,oBAAoB;MAACC,OAAO,EAAGE,CAAC,IAAKA,CAAC,CAACC,eAAe,CAAC,CAAE;MAAAF,QAAA,gBAGtEnH,OAAA;QAAKiH,SAAS,EAAC,cAAc;QAAAE,QAAA,gBAC3BnH,OAAA;UAAKiH,SAAS,EAAC,gBAAgB;UAAAE,QAAA,gBAC7BnH,OAAA,CAACL,QAAQ;YAAC6B,IAAI,EAAE,EAAG;YAACyF,SAAS,EAAC;UAAa;YAAAxF,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAC9C5B,OAAA;YAAAmH,QAAA,gBACEnH,OAAA;cAAAmH,QAAA,EAAI;YAAoB;cAAA1F,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI,CAAC,eAC7B5B,OAAA;cAAAmH,QAAA,EAAG;YAAyD;cAAA1F,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAG,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC7D,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,eACN5B,OAAA;UAAQiH,SAAS,EAAC,cAAc;UAACC,OAAO,EAAE7G,OAAQ;UAAA8G,QAAA,eAChDnH,OAAA,CAACN,CAAC;YAAC8B,IAAI,EAAE;UAAG;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACT,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC,eAGN5B,OAAA;QAAKiH,SAAS,EAAC,YAAY;QAAAE,QAAA,gBAEzBnH,OAAA;UAAKiH,SAAS,EAAC,gBAAgB;UAAAE,QAAA,gBAC7BnH,OAAA;YAAOiH,SAAS,EAAC,cAAc;YAAAE,QAAA,EAAC;UAEhC;YAAA1F,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAO,CAAC,eACR5B,OAAA;YAAKiH,SAAS,EAAC,wBAAwB;YAAAE,QAAA,eACrCnH,OAAA;cACEiH,SAAS,EAAC,iBAAiB;cAC3BK,WAAW,EAAC,gGAAgG;cAC5GC,KAAK,EAAE1G,WAAY;cACnB2G,QAAQ,EAAGJ,CAAC,IAAKtG,cAAc,CAACsG,CAAC,CAACK,MAAM,CAACF,KAAK,CAAE;cAChDG,IAAI,EAAE;YAAE;cAAAjG,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACT;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,eAGN5B,OAAA;UAAKiH,SAAS,EAAC,mBAAmB;UAAAE,QAAA,gBAChCnH,OAAA;YAAAmH,QAAA,EAAI;UAA8B;YAAA1F,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eACvC5B,OAAA;YAAKiH,SAAS,EAAC,gBAAgB;YAAAE,QAAA,EAC5BhG,cAAc,CAACqB,GAAG,CAACnB,QAAQ,iBAC1BrB,OAAA;cAEEiH,SAAS,EAAE,mBAAmBlG,iBAAiB,CAACkB,QAAQ,CAACZ,QAAQ,CAACD,EAAE,CAAC,GAAG,UAAU,GAAG,EAAE,EAAG;cAC1F8F,OAAO,EAAEA,CAAA,KAAMpF,cAAc,CAACT,QAAQ,CAACD,EAAE,CAAE;cAAA+F,QAAA,GAE1C9F,QAAQ,CAACE,IAAI,eACdvB,OAAA;gBAAAmH,QAAA,EAAO9F,QAAQ,CAACA;cAAQ;gBAAAI,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAO,CAAC;YAAA,GAL3BP,QAAQ,CAACD,EAAE;cAAAK,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAMV,CACT;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,eAGN5B,OAAA;UAAKiH,SAAS,EAAC,kBAAkB;UAAAE,QAAA,gBAC/BnH,OAAA;YAAAmH,QAAA,EAAI;UAAiB;YAAA1F,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eAC1B5B,OAAA;YAAKiH,SAAS,EAAC,eAAe;YAAAE,QAAA,EAC3BtF,cAAc,CAACW,GAAG,CAAC,CAACmF,OAAO,EAAEC,KAAK,kBACjC5H,OAAA;cAEEiH,SAAS,EAAC,gBAAgB;cAC1BC,OAAO,EAAEA,CAAA,KAAMpG,cAAc,CAAC6G,OAAO,CAAE;cAAAR,QAAA,GACxC,IACE,EAACQ,OAAO,EAAC,IACZ;YAAA,GALOC,KAAK;cAAAnG,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAKJ,CACT;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eAGN5B,OAAA;QAAKiH,SAAS,EAAC,cAAc;QAAAE,QAAA,gBAC3BnH,OAAA;UACEiH,SAAS,EAAC,cAAc;UACxBC,OAAO,EAAEF,QAAS;UAClBa,QAAQ,EAAE,CAAChH,WAAW,IAAIE,iBAAiB,CAACsB,MAAM,KAAK,CAAE;UAAA8E,QAAA,EAC1D;QAED;UAAA1F,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eACT5B,OAAA;UACEiH,SAAS,EAAC,eAAe;UACzBC,OAAO,EAAE/E,YAAa;UACtB0F,QAAQ,EAAG,CAAChH,WAAW,CAACuB,IAAI,CAAC,CAAC,IAAIrB,iBAAiB,CAACsB,MAAM,KAAK,CAAC,IAAKpB,YAAa;UAAAkG,QAAA,EAEjFlG,YAAY,gBACXjB,OAAA,CAAAE,SAAA;YAAAiH,QAAA,gBACEnH,OAAA;cAAKiH,SAAS,EAAC;YAAS;cAAAxF,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,uBAEjC;UAAA,eAAE,CAAC,gBAEH5B,OAAA,CAAAE,SAAA;YAAAiH,QAAA,gBACEnH,OAAA,CAACJ,IAAI;cAAC4B,IAAI,EAAE;YAAG;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,gBAEpB;UAAA,eAAE;QACH;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACK,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAEH;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAACrB,EAAA,CAnWIJ,gBAAiD;AAAA2H,EAAA,GAAjD3H,gBAAiD;AAqWvD,eAAeA,gBAAgB;AAAC,IAAA2H,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}